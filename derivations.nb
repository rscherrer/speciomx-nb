(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     45580,       1306]
NotebookOptionsPosition[     40769,       1222]
NotebookOutlinePosition[     41163,       1238]
CellTagsIndexPosition[     41120,       1235]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["\<\
In this notebook we illustrate and validate the derivations performed in the \
paper.\
\>", "Text",
 CellChangeTimes->{{3.832671374487945*^9, 3.8326713926680307`*^9}, {
  3.832671460440859*^9, 3.83267147262819*^9}, {3.832671547061775*^9, 
  3.8326715490477343`*^9}},ExpressionUUID->"8edf0ac2-0b4f-4d3e-bacb-\
9ec2b6febddf"],

Cell[CellGroupData[{

Cell["The model", "Subsection",
 CellChangeTimes->{{3.832671269606463*^9, 
  3.832671275637136*^9}},ExpressionUUID->"38449ed5-c3c7-40a4-932c-\
2198d4529682"],

Cell["The model is as follows:", "Text",
 CellChangeTimes->{{3.832667358070565*^9, 
  3.83266738101742*^9}},ExpressionUUID->"a8fafe17-910c-43a3-8886-\
3ab856667bc7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Transition", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{
    RowBox[{"\[CapitalLambda]", " ", "=", 
     RowBox[{"M", ".", "Q"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Migration", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"M", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"1", "-", "m"}], ",", "m"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", 
         RowBox[{"1", "-", "m"}]}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Geometric", " ", "growth", " ", "rates"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Q", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         SubscriptBox["r", "1"], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         SubscriptBox["r", "2"]}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["r", "1"], "[", 
     RowBox[{"y_", ",", "x_"}], "]"}], ":=", 
    RowBox[{"1", "-", "d", "+", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{
       SubscriptBox["W", "1"], "[", 
       RowBox[{"y", ",", "x"}], "]"}], 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"A", "[", 
         RowBox[{"y", ",", "x"}], "]"}]}], ")"}]}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["r", "2"], "[", 
     RowBox[{"y_", ",", "x_"}], "]"}], ":=", 
    RowBox[{"1", "-", "d", "+", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{
       SubscriptBox["W", "2"], "[", 
       RowBox[{"y", ",", "x"}], "]"}], 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"A", "[", 
         RowBox[{"y", ",", "x"}], "]"}]}], ")"}]}]}]}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Assortative", " ", "mating"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"A", "[", 
     RowBox[{"y_", ",", "x_"}], "]"}], ":=", 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"-", "a"}], 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"y", "-", "x"}], ")"}], "2"]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Reproductive", " ", "success"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["W", "1"], "[", 
     RowBox[{"y_", ",", "x_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["w", "1"], "[", "y", "]"}], 
      RowBox[{
       SubscriptBox["R", "11"], "[", "x", "]"}]}], "+", 
     RowBox[{
      RowBox[{
       SubscriptBox["w", "2"], "[", "y", "]"}], 
      RowBox[{
       SubscriptBox["R", "21"], "[", "x", "]"}]}]}]}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     SubscriptBox["W", "2"], "[", 
     RowBox[{"y_", ",", "x_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["w", "1"], "[", "y", "]"}], 
      RowBox[{
       SubscriptBox["R", "12"], "[", "x", "]"}]}], "+", 
     RowBox[{
      RowBox[{
       SubscriptBox["w", "2"], "[", "y", "]"}], 
      RowBox[{
       SubscriptBox["R", "22"], "[", "x", "]"}]}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Equilibrium", " ", "resource", " ", "concentrations"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["R", "11"], "[", "x_", "]"}], ":=", 
    FractionBox[
     RowBox[{"\[Iota]", " "}], 
     RowBox[{"\[Omicron]", "+", 
      RowBox[{
       SubscriptBox["N", "1"], " ", 
       RowBox[{
        SubscriptBox["w", "1"], "[", "x", "]"}]}]}]]}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["R", "12"], "[", "x_", "]"}], ":=", 
    RowBox[{"h", 
     FractionBox["\[Iota]", 
      RowBox[{"\[Omicron]", "+", 
       RowBox[{
        SubscriptBox["N", "2"], " ", 
        RowBox[{
         SubscriptBox["w", "1"], "[", "x", "]"}]}]}]]}]}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["R", "21"], "[", "x_", "]"}], ":=", 
    RowBox[{"h", 
     FractionBox["\[Iota]", 
      RowBox[{"\[Omicron]", "+", 
       RowBox[{
        SubscriptBox["N", "1"], " ", 
        RowBox[{
         SubscriptBox["w", "2"], "[", "x", "]"}]}]}]]}]}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["R", "22"], "[", "x_", "]"}], ":=", 
    FractionBox[
     RowBox[{"\[Iota]", " "}], 
     RowBox[{"\[Omicron]", "+", 
      RowBox[{
       SubscriptBox["N", "2"], " ", 
       RowBox[{
        SubscriptBox["w", "2"], "[", "x", "]"}]}]}]]}], " ", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Attack", " ", "rates"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["w", "1"], "[", "x_", "]"}], ":=", 
    RowBox[{"w0", " ", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", "s"}], 
       FractionBox[
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"x", "+", "\[Psi]"}], ")"}], "2"], 
        SuperscriptBox["\[Psi]", "2"]]}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["w", "2"], "[", "x_", "]"}], ":=", 
    RowBox[{"w0", " ", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", "s"}], 
       FractionBox[
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"x", "-", "\[Psi]"}], ")"}], "2"], 
        SuperscriptBox["\[Psi]", "2"]]}], "]"}]}]}]}]}]], "Input",
 CellChangeTimes->{{3.832667274495528*^9, 3.832667343663495*^9}, {
  3.8326674142589207`*^9, 3.832667490739038*^9}, {3.832667565640573*^9, 
  3.832667759063352*^9}, {3.838708862010676*^9, 3.8387088677383003`*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"0a8d89cd-35ba-4ed2-8ed3-1a8b4f9e2255"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Invasion fitness", "Subsection",
 CellChangeTimes->{{3.832671307390046*^9, 
  3.832671310487897*^9}},ExpressionUUID->"2d4f56c1-92d5-4900-9be9-\
dd19bb7dc92e"],

Cell["\<\
The invasion fitness is the leading eigenvalue of the transition matrix:\
\>", "Text",
 CellChangeTimes->{{3.832667814782535*^9, 
  3.8326678476495934`*^9}},ExpressionUUID->"7747a322-7938-4a15-982b-\
0e5794587e87"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Invasion", " ", "fitness"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"\[Lambda]", "=", 
   RowBox[{
    RowBox[{"\[CapitalLambda]", "//", "Eigenvalues"}], "//", 
    "Last"}]}]}]], "Input",
 CellChangeTimes->{{3.8326677877248697`*^9, 3.832667808262054*^9}, 
   3.832667849528261*^9, {3.832667881429566*^9, 3.832667892909333*^9}, {
   3.832667940519269*^9, 3.832667946522503*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"10d1478e-693f-4b42-920a-8af9d9f55d04"],

Cell[BoxData[
 RowBox[{
  FractionBox["1", "2"], " ", 
  RowBox[{"(", 
   RowBox[{
    SubscriptBox["r", "1"], "-", 
    RowBox[{"m", " ", 
     SubscriptBox["r", "1"]}], "+", 
    SubscriptBox["r", "2"], "-", 
    RowBox[{"m", " ", 
     SubscriptBox["r", "2"]}], "+", 
    SqrtBox[
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", 
          SubscriptBox["r", "1"]}], "+", 
         RowBox[{"m", " ", 
          SubscriptBox["r", "1"]}], "-", 
         SubscriptBox["r", "2"], "+", 
         RowBox[{"m", " ", 
          SubscriptBox["r", "2"]}]}], ")"}], "2"], "-", 
      RowBox[{"4", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["r", "1"], " ", 
          SubscriptBox["r", "2"]}], "-", 
         RowBox[{"2", " ", "m", " ", 
          SubscriptBox["r", "1"], " ", 
          SubscriptBox["r", "2"]}]}], ")"}]}]}]]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.8326677943175173`*^9, 3.8326677988622313`*^9}, 
   3.832667851647958*^9, 3.8328215037988157`*^9, 3.8386996152401543`*^9, 
   3.83870053440333*^9, 3.838700622763132*^9, 3.838700872140984*^9, 
   3.8387081997827578`*^9, 3.8387088727093983`*^9},
 CellLabel->"Out[85]=",ExpressionUUID->"df436939-3753-48da-8e2e-b4ad5b15ad66"]
}, Open  ]],

Cell["\<\
Next, we check that the invasion fitness of the resident is one, at some \
arbitrary trait value (e.g. 0.34):\
\>", "Text",
 CellChangeTimes->{{3.832821589963496*^9, 
  3.832821625289441*^9}},ExpressionUUID->"d84dc5f8-94cf-4538-8846-\
610b2a20c5b8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Example", " ", "parameter", " ", "set"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"pars", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[Iota]", "\[Rule]", "400"}], ",", 
       RowBox[{"\[Omicron]", "\[Rule]", "100"}], ",", 
       RowBox[{"h", "\[Rule]", "1"}], ",", 
       RowBox[{"s", "\[Rule]", "1"}], ",", 
       RowBox[{"\[Psi]", "\[Rule]", "5"}], ",", 
       RowBox[{"d", "\[Rule]", "0.2"}], ",", 
       RowBox[{"m", "\[Rule]", "0.01"}], ",", 
       RowBox[{"a", "\[Rule]", "1"}], ",", 
       RowBox[{"w0", "\[Rule]", "1"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Solve", " ", "the", " ", "equilibrium", " ", "population", " ", 
     "densities"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"eq", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["N", "1"], ",", 
          SubscriptBox["N", "2"]}], "}"}], "\[Equal]", 
        RowBox[{"\[CapitalLambda]", ".", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["N", "1"], ",", 
           SubscriptBox["N", "2"]}], "}"}]}]}], "/.", 
       RowBox[{
        SubscriptBox["r", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["r", "1"], "[", 
         RowBox[{"x", ",", "x"}], "]"}]}]}], "/.", 
      RowBox[{
       SubscriptBox["r", "2"], "\[Rule]", 
       RowBox[{
        SubscriptBox["r", "2"], "[", 
        RowBox[{"x", ",", "x"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"neq", "=", 
     RowBox[{"FindRoot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"eq", "/.", "pars"}], "/.", 
        RowBox[{"x", "\[Rule]", "0.34"}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["N", "1"], ",", "1000"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["N", "2"], ",", "1000"}], "}"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Compute", " ", "the", " ", "invasion", " ", "fitness", " ", "of", " ", 
     "the", " ", "resident"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"\[Lambda]", "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          SubscriptBox["r", "1"], "\[Rule]", 
          RowBox[{
           SubscriptBox["r", "1"], "[", 
           RowBox[{"x", ",", "x"}], "]"}]}], ",", 
         RowBox[{
          SubscriptBox["r", "2"], "\[Rule]", 
          RowBox[{
           SubscriptBox["r", "2"], "[", 
           RowBox[{"x", ",", "x"}], "]"}]}]}], "}"}]}], "/.", "pars"}], "/.", 
     "neq"}], "/.", 
    RowBox[{"x", "\[Rule]", "0.34"}]}]}]}]], "Input",
 CellChangeTimes->{{3.832821509538669*^9, 3.832821581406436*^9}, {
   3.838700626039721*^9, 3.838700626879218*^9}, 3.8387008331176443`*^9, {
   3.838708878324971*^9, 3.838708880794126*^9}},
 CellLabel->"In[90]:=",ExpressionUUID->"b8e14f97-e49c-4143-a36a-6690b1611608"],

Cell[BoxData["0.9999999999999994`"], "Output",
 CellChangeTimes->{{3.832821553920884*^9, 3.832821581715217*^9}, 
   3.838699620970358*^9, 3.838700536997937*^9, {3.838700628180745*^9, 
   3.838700635639781*^9}, 3.8387008339780703`*^9, {3.838700877157255*^9, 
   3.838700883729513*^9}, 3.8387081998458033`*^9, {3.838708881379767*^9, 
   3.838708883895056*^9}},
 CellLabel->"Out[93]=",ExpressionUUID->"161bd21e-7b29-4e79-8441-932e591805ed"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Selection gradient", "Subsection",
 CellChangeTimes->{{3.832671332466559*^9, 
  3.832671335102071*^9}},ExpressionUUID->"9ee9a4c5-45eb-4b27-89db-\
36c2e504c7a9"],

Cell["\<\
The selection gradient can be obtained by differentiating the invasion \
fitness, but it may then be computationally intensive to perform this \
operation many times (e.g. if we want to explore parameter space at a fine \
resolution or if we want to simulate the dynamics). Alternatively, we can \
express the selection gradient as:\
\>", "Text",
 CellChangeTimes->{{3.832668016067803*^9, 3.832668068336957*^9}, {
   3.83266849029241*^9, 3.832668493326136*^9}, {3.832669657165042*^9, 
   3.832669719698777*^9}, 3.832669943173191*^9, {3.8382686110483103`*^9, 
   3.838268643438664*^9}},ExpressionUUID->"21d92d28-ab03-4e4c-9b35-\
6ece61f8429d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Selection", " ", "gradient"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"G", "=", 
    RowBox[{
     RowBox[{"v", ".", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "-", "m"}], ",", "m"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"m", ",", 
          RowBox[{"1", "-", "m"}]}], "}"}]}], "}"}], ".", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["dW", "1"], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          SubscriptBox["dW", "2"]}], "}"}]}], "}"}], ".", "u"}], "/", 
     RowBox[{"(", 
      RowBox[{"v", ".", "u"}], ")"}]}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.8326679748079023`*^9, 3.8326679759229097`*^9}, {
  3.832668011356173*^9, 3.832668125184325*^9}, {3.832668157219956*^9, 
  3.832668161722521*^9}, {3.83266824803762*^9, 3.832668256092852*^9}, {
  3.83266833575951*^9, 3.832668378293605*^9}, {3.832668461302793*^9, 
  3.8326684627721987`*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"6ffd8597-f22e-4854-a58f-a27e82bbe9a6"],

Cell["\<\
We extract expressions for the eigenvectors of the transition matrix:\
\>", "Text",
 CellChangeTimes->{{3.832668468423514*^9, 
  3.832668499430649*^9}},ExpressionUUID->"dcff8c11-e4ec-4d33-bd08-\
c26cad556eb2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Eigenvectors", " ", "of", " ", "the", " ", "transition", " ", "matrix"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"right", "=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[CapitalLambda]", "//", "Eigenvectors"}], "//", "Last"}], 
       ")"}], " ", "m", " ", 
      SubscriptBox["r", "1"]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"left", "=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"\[CapitalLambda]", "//", "Transpose"}], "//", 
         "Eigenvectors"}], "//", "Last"}], ")"}], " ", "m", " ", 
      SubscriptBox["r", "2"]}]}], ";"}]}]}]], "Input",
 CellLabel->"In[95]:=",ExpressionUUID->"945e1268-a6f5-4066-9c21-81666a7bea94"],

Cell["\<\
We check that the eigenvectors can be re-written in terms of \[Lambda]:\
\>", "Text",
 CellChangeTimes->{{3.832668301203137*^9, 3.832668326511528*^9}, {
  3.832668502700206*^9, 
  3.832668503447893*^9}},ExpressionUUID->"521f5168-1849-49e5-a943-\
a43c6759078d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"\[Lambda]", "-", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "m"}], ")"}], 
     SubscriptBox["r", "2"]}]}], "\[Equal]", 
   RowBox[{"left", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
   RowBox[{"right", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], " ", "//", "Simplify"}]], "Input",
 CellLabel->"In[97]:=",ExpressionUUID->"f29e1cb8-d221-4f9e-b00b-62c2d7467c6c"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.832668129479479*^9, 3.832668268899115*^9, 
  3.83266833999193*^9, 3.838700545666192*^9, 3.838700643704417*^9, 
  3.838700841850897*^9, 3.838700890747408*^9, 3.8387082001700153`*^9, 
  3.838708897138959*^9},
 CellLabel->"Out[97]=",ExpressionUUID->"fb4709c6-dbd9-4838-be36-5480f094490a"]
}, Open  ]],

Cell["\<\
We substitute the eigenvectors and get a new expression for the selection \
gradient:\
\>", "Text",
 CellChangeTimes->{{3.83266841300463*^9, 3.83266845477507*^9}, {
  3.832668513402257*^9, 
  3.832668514996482*^9}},ExpressionUUID->"6ddb79a7-0d15-4394-a8ce-\
54c7dde21483"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Re", "-", 
    RowBox[{"write", " ", "the", " ", "eigenvectors"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"left", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "=", 
     RowBox[{"\[Lambda]", "-", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", "m"}], ")"}], 
       SubscriptBox["r", "2"]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"right", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "=", 
     RowBox[{"\[Lambda]", "-", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", "m"}], ")"}], 
       SubscriptBox["r", "2"]}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "Substitute", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"G", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"G", "/.", 
        RowBox[{"u", "\[Rule]", "right"}]}], "/.", 
       RowBox[{"v", "\[Rule]", "left"}]}], "/.", 
      RowBox[{"\[Lambda]", "\[Rule]", "1"}]}], "//", 
     "Simplify"}]}]}]}]], "Input",
 CellChangeTimes->{{3.8326683649197474`*^9, 3.8326683802550783`*^9}, {
  3.83266853187462*^9, 3.832668533186056*^9}},
 CellLabel->"In[98]:=",ExpressionUUID->"81df60dc-ce81-47eb-9c94-d68b55b16c89"],

Cell[BoxData[
 FractionBox[
  RowBox[{
   RowBox[{
    SuperscriptBox["m", "2"], " ", 
    SubscriptBox["dW", "2"], " ", 
    SubscriptBox["r", "1"]}], "+", 
   RowBox[{
    SubscriptBox["dW", "1"], " ", 
    RowBox[{"(", 
     RowBox[{"1", "-", "m", "-", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2", "-", 
         RowBox[{"4", " ", "m"}], "+", 
         SuperscriptBox["m", "2"]}], ")"}], " ", 
       SubscriptBox["r", "2"]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"3", " ", "m"}], "+", 
         RowBox[{"2", " ", 
          SuperscriptBox["m", "2"]}]}], ")"}], " ", 
       SubsuperscriptBox["r", "2", "2"]}]}], ")"}]}]}], 
  RowBox[{"1", "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"-", "2"}], "+", 
      RowBox[{"2", " ", "m"}], "+", 
      RowBox[{
       SuperscriptBox["m", "2"], " ", 
       SubscriptBox["r", "1"]}]}], ")"}], " ", 
    SubscriptBox["r", "2"]}], "+", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "1"}], "+", "m"}], ")"}], "2"], " ", 
    SubsuperscriptBox["r", "2", "2"]}]}]]], "Output",
 CellChangeTimes->{{3.8326685264741497`*^9, 3.832668533765871*^9}, 
   3.838700554725944*^9, 3.838700645547161*^9, 3.8387008438691874`*^9, 
   3.8387008924494247`*^9, 3.838708200214108*^9, 3.838708899197627*^9},
 CellLabel->
  "Out[100]=",ExpressionUUID->"d27e5acc-9871-4b4f-a0cd-84c7345e8bd2"]
}, Open  ]],

Cell["\<\
We check that this expression gives the same result as brute-force \
differentiation of the invasion fitness function (evaluated at some resident \
trait value, e.g. x = 0.34):\
\>", "Text",
 CellChangeTimes->{{3.8326691571785307`*^9, 3.8326691742790117`*^9}, {
  3.832669267869256*^9, 3.8326692894211197`*^9}, {3.832670503569339*^9, 
  3.8326705127341003`*^9}, {3.832670563596053*^9, 
  3.8326705798127823`*^9}},ExpressionUUID->"2a71c8e5-1b3c-4d15-ac55-\
227daa0d7918"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Differentiate", " ", "the", " ", "invasion", " ", "fitness"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"diff", "=", 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"\[Lambda]", "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           SubscriptBox["r", "1"], "\[Rule]", 
           RowBox[{
            SubscriptBox["r", "1"], "[", 
            RowBox[{"y", ",", "x"}], "]"}]}], ",", 
          RowBox[{
           SubscriptBox["r", "2"], "\[Rule]", 
           RowBox[{
            SubscriptBox["r", "2"], "[", 
            RowBox[{"y", ",", "x"}], "]"}]}]}], "}"}]}], ",", "y"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Evaluate", " ", "at", " ", "resident"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"diff", "/.", 
       RowBox[{"y", "\[Rule]", "x"}]}], "/.", "pars"}], "/.", "neq"}], "/.", 
    RowBox[{"x", "\[Rule]", "0.34"}]}]}]}]], "Input",
 CellChangeTimes->{{3.832668592330491*^9, 3.832669033268675*^9}, {
  3.832669066215666*^9, 3.832669143219049*^9}, {3.832669297966551*^9, 
  3.832669368560774*^9}, {3.832669427421949*^9, 3.832669454199162*^9}, {
  3.8326694874876432`*^9, 3.832669504400942*^9}, {3.832669546016856*^9, 
  3.8326695477273607`*^9}, {3.8326704549817133`*^9, 3.832670483348914*^9}, {
  3.832821637251666*^9, 3.832821639346635*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"b5f5b8f0-0942-4cbd-b1ab-6dad1245c737"],

Cell[BoxData[
 RowBox[{"-", "0.0046949732662349124`"}]], "Output",
 CellChangeTimes->{
  3.832669552419455*^9, {3.832670476127252*^9, 3.832670483823621*^9}, 
   3.838700557621107*^9, 3.838700648589879*^9, 3.838700846998296*^9, 
   3.838700894831641*^9, 3.838708200238887*^9, 3.838708902964295*^9},
 CellLabel->
  "Out[102]=",ExpressionUUID->"fe6694c3-db65-4c8f-bf40-a88ec4de6482"]
}, Open  ]],

Cell["\<\
Compare the value to that evaluated from the simplified expression at the \
same resident trait value:\
\>", "Text",
 CellChangeTimes->{{3.832669555747225*^9, 3.832669570804941*^9}, {
  3.832670530476573*^9, 
  3.832670534818697*^9}},ExpressionUUID->"bcad4c75-3597-4726-8457-\
cf5a3d34cf64"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Derivatives", " ", "of", " ", "the", " ", "reproductive", " ", "success", 
    " ", "function"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["dW", "1"], "[", "x_", "]"}], ":=", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{
        RowBox[{
         SubscriptBox["W", "1"], "[", 
         RowBox[{"y", ",", "x"}], "]"}], ",", "y"}], "]"}], "/.", 
      RowBox[{"y", "\[Rule]", "x"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["dW", "2"], "[", "x_", "]"}], ":=", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{
        RowBox[{
         SubscriptBox["W", "2"], "[", 
         RowBox[{"y", ",", "x"}], "]"}], ",", "y"}], "]"}], "/.", 
      RowBox[{"y", "\[Rule]", "x"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Compare", " ", "to", " ", "simplified", " ", "expression"}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"G", "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          SubscriptBox["r", "1"], "\[Rule]", 
          RowBox[{
           SubscriptBox["r", "1"], "[", 
           RowBox[{"x", ",", "x"}], "]"}]}], ",", 
         RowBox[{
          SubscriptBox["r", "2"], "\[Rule]", 
          RowBox[{
           SubscriptBox["r", "2"], "[", 
           RowBox[{"x", ",", "x"}], "]"}]}], ",", 
         RowBox[{
          SubscriptBox["dW", "1"], "\[Rule]", 
          RowBox[{
           SubscriptBox["dW", "1"], "[", "x", "]"}]}], ",", 
         RowBox[{
          SubscriptBox["dW", "2"], "\[Rule]", 
          RowBox[{
           SubscriptBox["dW", "2"], "[", "x", "]"}]}]}], "}"}]}], "/.", 
      "pars"}], "/.", "neq"}], "/.", 
    RowBox[{"x", "\[Rule]", "0.34"}]}]}]}]], "Input",
 CellChangeTimes->{{3.8326704882527943`*^9, 3.832670490583497*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"d6d6017f-4f04-433a-adff-82257f2b1f08"],

Cell[BoxData[
 RowBox[{"-", "0.004694973266235842`"}]], "Output",
 CellChangeTimes->{{3.83266899184744*^9, 3.832669014230384*^9}, 
   3.832669147983993*^9, 3.832669321048489*^9, 3.832669394904744*^9, {
   3.832669472941555*^9, 3.832669504931041*^9}, 3.832669573784605*^9, 
   3.832670490948596*^9, 3.832670604102441*^9, 3.838700562244363*^9, 
   3.838700651491411*^9, 3.838700849414171*^9, 3.838700896834549*^9, 
   3.8387082002665854`*^9, 3.8387089050451307`*^9},
 CellLabel->
  "Out[105]=",ExpressionUUID->"7de8ae52-bc40-4d51-8e1d-fcb5895e8944"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Evolutionary stability", "Subsection",
 CellChangeTimes->{{3.8326713461159563`*^9, 
  3.8326713487209673`*^9}},ExpressionUUID->"51e9bc9e-3157-42da-b757-\
1a1fe40803b0"],

Cell["\<\
Similarly we derived an expression for the curvature of the fitness function, \
which we can use to assess evolutionary stability of an equilibrium, singular \
strategy.\
\>", "Text",
 CellChangeTimes->{{3.832670036387233*^9, 
  3.8326700927081137`*^9}},ExpressionUUID->"9f32a1d3-880d-4d1f-a6cc-\
705aa77ccf5d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Curvature", " ", "of", " ", "the", " ", "fitness", " ", "function"}], " ",
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"F", "=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"dv", ".", "M", ".", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            SubscriptBox["dW", "1"], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            SubscriptBox["dW", "2"]}], "}"}]}], "}"}], ".", "u"}], " ", "+", 
       " ", 
       RowBox[{"v", ".", "M", ".", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             SubscriptBox["ddW", "1"], "-", 
             RowBox[{"a", " ", 
              SubscriptBox["W", "1"]}]}], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             SubscriptBox["ddW", "2"], "-", 
             RowBox[{"a", " ", 
              SubscriptBox["W", "2"]}]}]}], "}"}]}], "}"}], ".", "u"}], " ", 
       "+", " ", 
       RowBox[{"v", ".", "M", ".", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            SubscriptBox["dW", "1"], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            SubscriptBox["dW", "2"]}], "}"}]}], "}"}], ".", "du"}]}], ")"}], 
     "/", 
     RowBox[{"(", 
      RowBox[{"v", ".", "u"}], ")"}]}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.8326700091329403`*^9, 3.832670032963969*^9}},
 CellLabel->
  "In[106]:=",ExpressionUUID->"48a5e3d2-ea74-45fb-b48f-13f67973f538"],

Cell["\<\
Expressions for the derivatives of the eigenvectors allow to simplify the \
expression of the curvature:\
\>", "Text",
 CellChangeTimes->{{3.8326701262995253`*^9, 
  3.8326701807716007`*^9}},ExpressionUUID->"f3fc8756-d6f6-432e-a388-\
b60b6a5c4f0d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Derivatives", " ", "of", " ", "the", " ", "eigenvectors"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"dleft", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"m", "-", "1"}], ")"}], 
        SubscriptBox["dW", "2"]}], ",", 
       RowBox[{"m", " ", 
        SubscriptBox["dW", "2"]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dright", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"m", "-", "1"}], ")"}], 
        SubscriptBox["dW", "2"]}], ",", 
       RowBox[{"m", " ", 
        SubscriptBox["dW", "1"]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "Substitute", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"F", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"F", "/.", 
          RowBox[{"u", "\[Rule]", "right"}]}], "/.", 
         RowBox[{"v", "\[Rule]", "left"}]}], "/.", 
        RowBox[{"du", "\[Rule]", "dright"}]}], "/.", 
       RowBox[{"dv", "\[Rule]", "dleft"}]}], "/.", 
      RowBox[{"\[Lambda]", "\[Rule]", "1"}]}], "//", 
     "Simplify"}]}]}]}]], "Input",
 CellChangeTimes->{{3.832668942259782*^9, 3.832668951255611*^9}, 
   3.8326701126421623`*^9, {3.832670169445449*^9, 3.832670169712941*^9}, {
   3.832670611196521*^9, 3.8326706312736607`*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"e10dfaf6-a857-4ae3-9071-e88e22407658"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     SuperscriptBox["m", "2"], " ", 
     SubscriptBox["ddW", "2"], " ", 
     SubscriptBox["r", "1"]}], "+", 
    RowBox[{"2", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "1"}], "+", 
       RowBox[{"2", " ", "m"}]}], ")"}], " ", 
     SubscriptBox["dW", "1"], " ", 
     SubscriptBox["dW", "2"], " ", 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
        SubscriptBox["r", "2"]}]}], ")"}]}], "+", 
    RowBox[{
     SubscriptBox["ddW", "1"], " ", 
     RowBox[{"(", 
      RowBox[{"1", "-", "m", "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"2", "-", 
          RowBox[{"4", " ", "m"}], "+", 
          SuperscriptBox["m", "2"]}], ")"}], " ", 
        SubscriptBox["r", "2"]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"3", " ", "m"}], "+", 
          RowBox[{"2", " ", 
           SuperscriptBox["m", "2"]}]}], ")"}], " ", 
        SubsuperscriptBox["r", "2", "2"]}]}], ")"}]}], "-", 
    RowBox[{"a", " ", 
     SubscriptBox["W", "1"]}], "+", 
    RowBox[{"a", " ", "m", " ", 
     SubscriptBox["W", "1"]}], "+", 
    RowBox[{"2", " ", "a", " ", 
     SubscriptBox["r", "2"], " ", 
     SubscriptBox["W", "1"]}], "-", 
    RowBox[{"4", " ", "a", " ", "m", " ", 
     SubscriptBox["r", "2"], " ", 
     SubscriptBox["W", "1"]}], "+", 
    RowBox[{"a", " ", 
     SuperscriptBox["m", "2"], " ", 
     SubscriptBox["r", "2"], " ", 
     SubscriptBox["W", "1"]}], "-", 
    RowBox[{"a", " ", 
     SubsuperscriptBox["r", "2", "2"], " ", 
     SubscriptBox["W", "1"]}], "+", 
    RowBox[{"3", " ", "a", " ", "m", " ", 
     SubsuperscriptBox["r", "2", "2"], " ", 
     SubscriptBox["W", "1"]}], "-", 
    RowBox[{"2", " ", "a", " ", 
     SuperscriptBox["m", "2"], " ", 
     SubsuperscriptBox["r", "2", "2"], " ", 
     SubscriptBox["W", "1"]}], "-", 
    RowBox[{"a", " ", 
     SuperscriptBox["m", "2"], " ", 
     SubscriptBox["r", "1"], " ", 
     SubscriptBox["W", "2"]}]}], ")"}], "/", 
  RowBox[{"(", 
   RowBox[{"1", "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "2"}], "+", 
       RowBox[{"2", " ", "m"}], "+", 
       RowBox[{
        SuperscriptBox["m", "2"], " ", 
        SubscriptBox["r", "1"]}]}], ")"}], " ", 
     SubscriptBox["r", "2"]}], "+", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "1"}], "+", "m"}], ")"}], "2"], " ", 
     SubsuperscriptBox["r", "2", "2"]}]}], ")"}]}]], "Output",
 CellChangeTimes->{3.8326701899061737`*^9, 3.832670608425227*^9, 
  3.832670643033533*^9, 3.8387005684595613`*^9, 3.838700659335848*^9, 
  3.838700857754437*^9, 3.838700902498577*^9, 3.838708200363718*^9, 
  3.8387089097553988`*^9},
 CellLabel->
  "Out[109]=",ExpressionUUID->"6ca989b3-115f-42ef-89c2-5e399fc80b71"]
}, Open  ]],

Cell["\<\
Again, we compare this expression to that obtained from brute-force \
differentiation of the invasion fitness (evaluated at a singular strategy, \
e.g. x = 0):\
\>", "Text",
 CellChangeTimes->{{3.8326702039604816`*^9, 3.832670223575163*^9}, {
  3.832670409145887*^9, 3.832670418918948*^9}, {3.8326705551456337`*^9, 
  3.8326705735459137`*^9}},ExpressionUUID->"faca5808-8c0b-453e-87e3-\
49611f9d9ebf"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Second", " ", "derivative", " ", "of", " ", "the", " ", "invasion", " ", 
    "fitness"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"diff2", "=", 
     RowBox[{"D", "[", 
      RowBox[{"diff", ",", "y"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Equilibrium", " ", "population", " ", "size"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"neq", "=", 
     RowBox[{"FindRoot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"eq", "/.", "pars"}], "/.", 
        RowBox[{"x", "\[Rule]", "0"}]}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["N", "1"], ",", "1000"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["N", "2"], ",", "1000"}], "}"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Evaluate", " ", "at", " ", "resident"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"diff2", "/.", 
       RowBox[{"y", "\[Rule]", "x"}]}], "/.", "pars"}], "/.", "neq"}], "/.", 
    RowBox[{"x", "\[Rule]", "0"}]}]}]}]], "Input",
 CellChangeTimes->{{3.832670237339107*^9, 3.832670262737587*^9}, {
  3.832670298225622*^9, 3.832670326168922*^9}, {3.832670424272962*^9, 
  3.832670440819645*^9}, {3.832670584239316*^9, 3.832670586242443*^9}, {
  3.832670652487918*^9, 3.832670658571178*^9}, {3.838708628539069*^9, 
  3.838708665344467*^9}, {3.838708750884053*^9, 3.83870880422013*^9}},
 CellLabel->
  "In[110]:=",ExpressionUUID->"b3ad3f2e-bb46-45c2-9550-8ffeebdf7d4b"],

Cell[BoxData[
 RowBox[{"-", "0.1840000000000002`"}]], "Output",
 CellChangeTimes->{
  3.832670359244669*^9, 3.8326705910107603`*^9, {3.832670647751142*^9, 
   3.832670658976125*^9}, 3.8387005740833387`*^9, 3.83870066266441*^9, 
   3.8387008601607857`*^9, 3.83870090502273*^9, 3.838708200396399*^9, {
   3.8387086491497707`*^9, 3.8387086659215927`*^9}, {3.838708751162991*^9, 
   3.8387087957601767`*^9}, 3.838708914958465*^9},
 CellLabel->
  "Out[112]=",ExpressionUUID->"6ddaa2c7-75eb-4ccc-8887-b1c14949e9ae"]
}, Open  ]],

Cell["Compare with the simplified expression:", "Text",
 CellChangeTimes->{{3.832670669789057*^9, 
  3.8326706762502203`*^9}},ExpressionUUID->"0cec746c-65fe-40d2-842e-\
7d263f44b2d7"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Second", " ", "derivatives", " ", "of", " ", "the", " ", "reproductive", 
    " ", "success"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["ddW", "1"], "[", "x_", "]"}], ":=", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["W", "1"], "[", 
          RowBox[{"y", ",", "x"}], "]"}], ",", "y"}], "]"}], ",", "y"}], 
      "]"}], "/.", 
     RowBox[{"y", "\[Rule]", "x"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     SubscriptBox["ddW", "2"], "[", "x_", "]"}], ":=", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["W", "2"], "[", 
          RowBox[{"y", ",", "x"}], "]"}], ",", "y"}], "]"}], ",", "y"}], 
      "]"}], "/.", 
     RowBox[{"y", "\[Rule]", "x"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Evaluate", " ", "fitness", " ", "curvature"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"F", "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          SubscriptBox["r", "1"], "\[Rule]", 
          RowBox[{
           SubscriptBox["r", "1"], "[", 
           RowBox[{"x", ",", "x"}], "]"}]}], ",", 
         RowBox[{
          SubscriptBox["r", "2"], "\[Rule]", 
          RowBox[{
           SubscriptBox["r", "2"], "[", 
           RowBox[{"x", ",", "x"}], "]"}]}], ",", 
         RowBox[{
          SubscriptBox["W", "1"], "\[Rule]", 
          RowBox[{
           SubscriptBox["W", "1"], "[", 
           RowBox[{"x", ",", "x"}], "]"}]}], ",", 
         RowBox[{
          SubscriptBox["W", "2"], "\[Rule]", 
          RowBox[{
           SubscriptBox["W", "2"], "[", 
           RowBox[{"x", ",", "x"}], "]"}]}], ",", 
         RowBox[{
          SubscriptBox["dW", "1"], "\[Rule]", 
          RowBox[{
           SubscriptBox["dW", "1"], "[", "x", "]"}]}], ",", 
         RowBox[{
          SubscriptBox["dW", "2"], "\[Rule]", 
          RowBox[{
           SubscriptBox["dW", "2"], "[", "x", "]"}]}], ",", 
         RowBox[{
          SubscriptBox["ddW", "1"], "\[Rule]", 
          RowBox[{
           SubscriptBox["ddW", "1"], "[", "x", "]"}]}], ",", 
         RowBox[{
          SubscriptBox["ddW", "2"], "\[Rule]", 
          RowBox[{
           SubscriptBox["ddW", "2"], "[", "x", "]"}]}]}], "}"}]}], "/.", 
      "pars"}], "/.", "neq"}], "/.", 
    RowBox[{"x", "\[Rule]", "0"}]}]}]}]], "Input",
 CellChangeTimes->{{3.8326706822852716`*^9, 3.83267072092959*^9}, {
  3.832670753552104*^9, 3.8326708194740753`*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"f0dbccdc-2e75-40d0-9e5f-2b82ee48777d"],

Cell[BoxData[
 RowBox[{"-", "0.18400000000017652`"}]], "Output",
 CellChangeTimes->{3.8326706846876574`*^9, 3.832670729059267*^9, 
  3.83267081998207*^9, 3.838700580504834*^9, 3.838700665215096*^9, 
  3.8387009071335163`*^9, 3.8387082004237757`*^9, 3.838708702118804*^9, 
  3.8387087983476562`*^9, 3.838708917814539*^9},
 CellLabel->
  "Out[115]=",ExpressionUUID->"8243eb6a-2ea7-48c7-86b8-bbe268802e62"]
}, Open  ]],

Cell["Make sure that the fitness gradient is indeed zero at x = 0:", "Text",
 CellChangeTimes->{{3.832670824442013*^9, 
  3.832670836095192*^9}},ExpressionUUID->"75d378cc-da33-451b-991d-\
3af716aa8fdf"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"G", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SubscriptBox["r", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["r", "1"], "[", 
         RowBox[{"x", ",", "x"}], "]"}]}], ",", 
       RowBox[{
        SubscriptBox["r", "2"], "\[Rule]", 
        RowBox[{
         SubscriptBox["r", "2"], "[", 
         RowBox[{"x", ",", "x"}], "]"}]}], ",", 
       RowBox[{
        SubscriptBox["dW", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["dW", "1"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["dW", "2"], "\[Rule]", 
        RowBox[{
         SubscriptBox["dW", "2"], "[", "x", "]"}]}]}], "}"}]}], "/.", 
    "pars"}], "/.", "neq"}], "/.", 
  RowBox[{"x", "\[Rule]", "0"}]}]], "Input",
 CellChangeTimes->{{3.832670838621974*^9, 3.8326708515226507`*^9}},
 CellLabel->
  "In[116]:=",ExpressionUUID->"f50ead7f-5605-45fd-9730-4ea4d15ba260"],

Cell[BoxData["0.`"], "Output",
 CellChangeTimes->{3.8326708518405743`*^9, 3.838700672291191*^9, 
  3.838700909278757*^9, 3.83870820044893*^9, 3.838708707219022*^9, 
  3.838708920526703*^9},
 CellLabel->
  "Out[116]=",ExpressionUUID->"e9517893-e9a1-4ee1-93d9-a52a02e27822"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{434.25, 463.5},
WindowMargins->{{0, Automatic}, {45, Automatic}},
FrontEndVersion->"12.1 for Linux x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"08128dc6-3972-4e2c-b0aa-4286e4632d58"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 333, 7, 58, "Text",ExpressionUUID->"8edf0ac2-0b4f-4d3e-bacb-9ec2b6febddf"],
Cell[CellGroupData[{
Cell[916, 31, 157, 3, 54, "Subsection",ExpressionUUID->"38449ed5-c3c7-40a4-932c-2198d4529682"],
Cell[1076, 36, 165, 3, 35, "Text",ExpressionUUID->"a8fafe17-910c-43a3-8886-3ab856667bc7"],
Cell[1244, 41, 6012, 191, 750, "Input",ExpressionUUID->"0a8d89cd-35ba-4ed2-8ed3-1a8b4f9e2255"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7293, 237, 164, 3, 54, "Subsection",ExpressionUUID->"2d4f56c1-92d5-4900-9be9-dd19bb7dc92e"],
Cell[7460, 242, 224, 5, 58, "Text",ExpressionUUID->"7747a322-7938-4a15-982b-0e5794587e87"],
Cell[CellGroupData[{
Cell[7709, 251, 523, 11, 51, "Input",ExpressionUUID->"10d1478e-693f-4b42-920a-8af9d9f55d04"],
Cell[8235, 264, 1273, 36, 93, "Output",ExpressionUUID->"df436939-3753-48da-8e2e-b4ad5b15ad66"]
}, Open  ]],
Cell[9523, 303, 259, 6, 81, "Text",ExpressionUUID->"d84dc5f8-94cf-4538-8846-610b2a20c5b8"],
Cell[CellGroupData[{
Cell[9807, 313, 3167, 89, 319, "Input",ExpressionUUID->"b8e14f97-e49c-4143-a36a-6690b1611608"],
Cell[12977, 404, 437, 6, 33, "Output",ExpressionUUID->"161bd21e-7b29-4e79-8441-932e591805ed"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[13463, 416, 166, 3, 54, "Subsection",ExpressionUUID->"9ee9a4c5-45eb-4b27-89db-36c2e504c7a9"],
Cell[13632, 421, 652, 11, 173, "Text",ExpressionUUID->"21d92d28-ab03-4e4c-9b35-6ece61f8429d"],
Cell[14287, 434, 1173, 31, 71, "Input",ExpressionUUID->"6ffd8597-f22e-4854-a58f-a27e82bbe9a6"],
Cell[15463, 467, 219, 5, 58, "Text",ExpressionUUID->"dcff8c11-e4ec-4d33-bd08-c26cad556eb2"],
Cell[15685, 474, 818, 24, 133, "Input",ExpressionUUID->"945e1268-a6f5-4066-9c21-81666a7bea94"],
Cell[16506, 500, 270, 6, 58, "Text",ExpressionUUID->"521f5168-1849-49e5-a943-a43c6759078d"],
Cell[CellGroupData[{
Cell[16801, 510, 433, 12, 51, "Input",ExpressionUUID->"f29e1cb8-d221-4f9e-b00b-62c2d7467c6c"],
Cell[17237, 524, 338, 5, 33, "Output",ExpressionUUID->"fb4709c6-dbd9-4838-be36-5480f094490a"]
}, Open  ]],
Cell[17590, 532, 282, 7, 58, "Text",ExpressionUUID->"6ddb79a7-0d15-4394-a8ce-54c7dde21483"],
Cell[CellGroupData[{
Cell[17897, 543, 1303, 38, 154, "Input",ExpressionUUID->"81df60dc-ce81-47eb-9c94-d68b55b16c89"],
Cell[19203, 583, 1434, 44, 81, "Output",ExpressionUUID->"d27e5acc-9871-4b4f-a0cd-84c7345e8bd2"]
}, Open  ]],
Cell[20652, 630, 480, 9, 104, "Text",ExpressionUUID->"2a71c8e5-1b3c-4d15-ac55-227daa0d7918"],
Cell[CellGroupData[{
Cell[21157, 643, 1579, 40, 154, "Input",ExpressionUUID->"b5f5b8f0-0942-4cbd-b1ab-6dad1245c737"],
Cell[22739, 685, 380, 7, 33, "Output",ExpressionUUID->"fe6694c3-db65-4c8f-bf40-a88ec4de6482"]
}, Open  ]],
Cell[23134, 695, 301, 7, 81, "Text",ExpressionUUID->"bcad4c75-3597-4726-8457-cf5a3d34cf64"],
Cell[CellGroupData[{
Cell[23460, 706, 2061, 61, 195, "Input",ExpressionUUID->"d6d6017f-4f04-433a-adff-82257f2b1f08"],
Cell[25524, 769, 547, 9, 33, "Output",ExpressionUUID->"7de8ae52-bc40-4d51-8e1d-fcb5895e8944"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[26120, 784, 174, 3, 54, "Subsection",ExpressionUUID->"51e9bc9e-3157-42da-b757-1a1fe40803b0"],
Cell[26297, 789, 321, 7, 104, "Text",ExpressionUUID->"9f32a1d3-880d-4d1f-a6cc-705aa77ccf5d"],
Cell[26621, 798, 1669, 51, 133, "Input",ExpressionUUID->"48a5e3d2-ea74-45fb-b48f-13f67973f538"],
Cell[28293, 851, 258, 6, 58, "Text",ExpressionUUID->"f3fc8756-d6f6-432e-a388-b60b6a5c4f0d"],
Cell[CellGroupData[{
Cell[28576, 861, 1566, 45, 174, "Input",ExpressionUUID->"e10dfaf6-a857-4ae3-9071-e88e22407658"],
Cell[30145, 908, 2954, 89, 167, "Output",ExpressionUUID->"6ca989b3-115f-42ef-89c2-5e399fc80b71"]
}, Open  ]],
Cell[33114, 1000, 410, 8, 81, "Text",ExpressionUUID->"faca5808-8c0b-453e-87e3-49611f9d9ebf"],
Cell[CellGroupData[{
Cell[33549, 1012, 1753, 46, 216, "Input",ExpressionUUID->"b3ad3f2e-bb46-45c2-9550-8ffeebdf7d4b"],
Cell[35305, 1060, 509, 9, 33, "Output",ExpressionUUID->"6ddaa2c7-75eb-4ccc-8887-b1c14949e9ae"]
}, Open  ]],
Cell[35829, 1072, 183, 3, 35, "Text",ExpressionUUID->"0cec746c-65fe-40d2-842e-7d263f44b2d7"],
Cell[CellGroupData[{
Cell[36037, 1079, 2829, 84, 236, "Input",ExpressionUUID->"f0dbccdc-2e75-40d0-9e5f-2b82ee48777d"],
Cell[38869, 1165, 403, 7, 33, "Output",ExpressionUUID->"8243eb6a-2ea7-48c7-86b8-bbe268802e62"]
}, Open  ]],
Cell[39287, 1175, 202, 3, 58, "Text",ExpressionUUID->"75d378cc-da33-451b-991d-3af716aa8fdf"],
Cell[CellGroupData[{
Cell[39514, 1182, 952, 29, 71, "Input",ExpressionUUID->"f50ead7f-5605-45fd-9730-4ea4d15ba260"],
Cell[40469, 1213, 272, 5, 33, "Output",ExpressionUUID->"e9517893-e9a1-4ee1-93d9-a52a02e27822"]
}, Open  ]]
}, Open  ]]
}
]
*)

